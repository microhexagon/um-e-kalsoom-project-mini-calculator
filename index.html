<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    };
  </script>
</head>
<body class="bg-white min-h-screen text-gray-900 dark:text-white flex items-center justify-center">

  <div class="bg-yellow-400 dark:bg-gray-800 flex items-center justify-center w-full min-h-screen">
    <div class="p-6 rounded-2xl shadow-xl w-[320px] mx-auto flex flex-col gap-4">

      <!-- Header with Dark Mode Toggle -->
      <div class="flex justify-between items-center mb-2">
        <h1 class="text-xl font-bold">Calculator</h1>
        <button id="darkModeToggle" class="p-2 rounded-full bg-gray-500 text-white">
          ðŸŒ™
        </button>
      </div>

      <!-- Input Display -->
      <input
        id="display"
        class="w-full text-right text-3xl font-mono p-4 border border-gray-300 rounded-lg bg-gray-500 text-white dark:bg-gray-600"
        type="text"
        value="0"
      />

      <!-- Buttons Grid -->
      <div class="grid grid-cols-4 gap-3">
        <button class="btn bg-red-600 hover:bg-red-700 text-white">C</button>
        <button class="btn bg-blue-500 hover:bg-blue-600 text-white">/</button>
        <button class="btn bg-blue-500 hover:bg-blue-600 text-white">*</button>
        <button class="btn bg-gray-600 hover:bg-gray-700 text-white">Del</button>

        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">7</button>
        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">8</button>
        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">9</button>
        <button class="btn bg-blue-500 hover:bg-blue-600 text-white">-</button>

        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">4</button>
        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">5</button>
        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">6</button>
        <button class="btn bg-blue-500 hover:bg-blue-600 text-white">+</button>

        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">1</button>
        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">2</button>
        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">3</button>
        <button class="btn bg-green-500 hover:bg-green-600 text-white row-span-2">=</button>

        <button class="btn bg-gray-400 hover:bg-gray-700 text-white col-span-2">0</button>
        <button class="btn bg-gray-400 hover:bg-gray-700 text-white">.</button>
      </div>
    </div>
  </div>

  <!-- Styling -->
  <style>
    .btn {
      @apply text-lg font-semibold py-3 rounded-xl transition;
    }

    body {
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .dark .text-gray-900 {
      color: #edf2f7;
    }
  </style>

  <!-- Script -->
  <script>
    const display = document.getElementById("display");
    const buttons = document.querySelectorAll(".btn");

    function getCaretPosition(el) {
      return el.selectionStart;
    }

    function setCaretPosition(el, pos) {
      el.setSelectionRange(pos, pos);
      el.focus();
    }

    buttons.forEach(button => {
      button.addEventListener("click", () => {
        const value = button.textContent;
        let currentValue = display.value;
        const cursorPos = getCaretPosition(display);

        if (value === "C") {
          display.value = "0";
          return;
        }

        if (value === "Del") {
          if (cursorPos > 0) {
            display.value = currentValue.slice(0, cursorPos - 1) + currentValue.slice(cursorPos);
            setCaretPosition(display, cursorPos - 1);
          }
          return;
        }

        if (value === "=") {
          try {
            const result = safeEvaluate(display.value);
            display.value = result.toString();
          } catch {
            display.value = "Error";
          }
          return;
        }

        // Insert character at cursor position
        const newValue = currentValue.slice(0, cursorPos) + value + currentValue.slice(cursorPos);
        display.value = newValue;
        setCaretPosition(display, cursorPos + value.length);
      });
    });

    function safeEvaluate(expression) {
      if (/\/0(?!\d)/.test(expression)) throw new Error("Divide by zero");
      return Function('"use strict";return (' + expression + ')')();
    }

    // Dark mode toggle logic
    const toggleBtn = document.getElementById('darkModeToggle');
    const updateIcon = () => {
      toggleBtn.textContent = document.documentElement.classList.contains('dark') ? "â˜€ï¸" : "ðŸŒ™";
    };

    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    }
    updateIcon();

    toggleBtn.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      const isDark = document.documentElement.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateIcon();
    });

    // Allow normal typing
    display.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        try {
          const result = safeEvaluate(display.value);
          display.value = result.toString();
        } catch {
          display.value = "Error";
        }
        e.preventDefault();
      }
    });
  </script>
</body>
</html>


   